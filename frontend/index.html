<!DOCTYPE html>
<html>
    <head>
        <title>Library Management System</title>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="main.css">
    </head>
    <body>
        <div class="nav">
            <a class="nav-item selected" href="#">Library</a>
            <a class="nav-item" href="./browse.html">Browse</a>
            <div class="nav-item">
                <input id="login-username" placeholder="username" spellcheck="false"></input>
                <input id="login-password" placeholder="password" spellcheck="false"></input>
                <button type="button" id="login-btn">Login</button>
                <div id="login-notif"></div>
            </div>
        </div>
        <form class="filter-bar">
            <input id="search-bar" placeholder="Search"/>
            <button type="button" id="search-btn">Search</button>
            <fieldset>
                <legend>Select a filter type</legend>
                <div>
                    <input type="radio" id="filter-name" name="Filter" value="Name"/>
                    <label for="name">Name</label>
                    <input type="radio" id="filter-author" name="Filter" value="Author"/>
                    <label for="author">Author</label>
                    <input type="radio" id="filter-length" name="Filter" value="Length" checked />
                    <label for="length">Length</label>
                </div> 
            </fieldset>
        </form>

        <!-- The following is a container intended for being populated via javascript -->
        <div class="library" id="book-container">
        </div>

        <div class="error-modal-container" id="error-modal-container" style="display: none">
          <div class="error-modal">
            <h1>This website requires backend server running</h1>
          </div>
        </div>

        <script src="main.js"></script>
        <script>
            const container = document.getElementById("book-container")
            const error_modal = document.getElementById("error-modal-container")

            makeQuery('', (result) => {
              makeQuery('books/debug/all', (result) => {
                for (let i in result) {
                  let book = result[i];
                  fetch(`https://bookcover.longitood.com/bookcover/${book.isbn}`).then(res => {
                    if (!res.ok) {
                      console.error('invalid response')
                      return
                    }
                    return res.json();
                  }).then(data => {
                    const dom = container.appendChild(createBookEntryDOM({
                      title: book.title,
                      author: book.author,
                      coverurl: data.url
                    }))
                    setupCoverEvents(dom)
                  }).catch(err => console.error(`error: ${err}`));
                }
              });

              setupSearchEventListener();
              setupLoginEventListeners();
            }, (error) => {
              console.error('could not contact server')
              error_modal.style.display = 'block'
            })
        </script>
    </body>
</html>
